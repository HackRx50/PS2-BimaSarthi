<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="bot.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="bajajlogo.png" alt="logo">
            </div>
            <ul class="nav-links">
                <li><a href="#">Home</a></li>
                <li><a href="#">MediMatchScan</a></li>
                <li><a href="#">MediMatchBot</a></li>
            </ul>
            <div class="menu-toggle">☰</div>
        </nav>
    </header>
    <h1  class="typewriter">Need assistance? Just ask me anything in real-time!</h1>
    <main class="chatbot-container">
        <div class="bot-image-container">
            <img src="bot.png" alt="Bot Image">
        </div>
       
        <div class="chat-ui-container">
            

            <div class="input-group">
                <input type="text" id="mrn" placeholder="Enter MRN">
                <button onclick="startChat()">Start</button>
            </div>

            <div id="chat-container">
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <div class="input-group">
                <input type="text" id="user-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>

            <div class="language-selector">
                <select id="language-select" onchange="changeLanguage()">
                    <option value="english">English</option>
                    <option value="hindi">हिन्दी (Hindi)</option>
                    <option value="bengali">বাংলা (Bengali)</option>
                    <option value="marathi">मराठी (Marathi)</option>
                    <option value="telugu">తెలుగు (Telugu)</option>
                    <option value="tamil">தமிழ் (Tamil)</option>
                    <option value="gujarati">ગુજરાતી (Gujarati)</option>
                    <option value="urdu">اردو (Urdu)</option>
                    <option value="kannada">ಕನ್ನಡ (Kannada)</option>
                    <option value="odia">ଓଡ଼ିଆ (Odia)</option>
                    <option value="malayalam">മലയാളം (Malayalam)</option>
                    <option value="punjabi">ਪੰਜਾਬੀ (Punjabi)</option>
                    <option value="assamese">অসমীয়া (Assamese)</option>
                </select>
            </div>
        </div>
    </main>

    <script>
        let currentLanguage = 'english';

        const languageMap = {
            'हिन्दी': 'hindi',
            'বাংলা': 'bengali',
            'मराठी': 'marathi',
            'తెలుగు': 'telugu',
            'தமிழ்': 'tamil',
            'ગુજરાતી': 'gujarati',
            'اردو': 'urdu',
            'ಕನ್ನಡ': 'kannada',
            'ଓଡ଼ିଆ': 'odia',
            'മലയാളം': 'malayalam',
            'ਪੰਜਾਬੀ': 'punjabi',
            'অসমীয়া': 'assamese'
        };

        function startChat() {
            $('#chat-container').empty();
            $('#chat-container').append('<div class="typing-indicator"><span></span><span></span><span></span></div>');
        }

        function sendMessage() {
            var mrn = $('#mrn').val();
            var message = $('#user-input').val();
            if (message.trim() === '') return;

            // Check if the message is a language change command
            const lowerMessage = message.toLowerCase();
            const nativeScriptLanguage = languageMap[message];
            if (languageMap.hasOwnProperty(message) || Object.values(languageMap).includes(lowerMessage)) {
                changeLanguage(nativeScriptLanguage || lowerMessage);
                $('#user-input').val('');
                return;
            }

            $('#chat-container').append('<p><strong>You:</strong> ' + message + '</p>');
            $('#user-input').val('');

            $('.typing-indicator').show();
            $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);

            $.post('/chat', {mrn: mrn, message: message, language: currentLanguage}, function(data) {
                $('.typing-indicator').hide();
                $('#chat-container').append('<p><strong>Bot:</strong> ' + data.response + '</p>');
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);

                if (data.language) {
                    currentLanguage = data.language;
                    $('#language-select').val(currentLanguage);
                }
            });
        }

        function changeLanguage(lang) {
            if (lang) {
                currentLanguage = lang;
                $('#language-select').val(currentLanguage);
            } else {
                currentLanguage = $('#language-select').val();
            }
            const message = `Switched to ${currentLanguage} language.`;
            $('#chat-container').append('<p><strong>System:</strong> ' + message + '</p>');
            $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
        }

        $('#user-input').keypress(function(e) {
            if(e.which == 13) {
                sendMessage();
                return false;
            }
        });
    </script>
</body>
</html>
